10 SCREEN 1: COLOR 15,1,1: CLS
20 DIM BOARD(9,19), PIECES(6,3,3)
30 RANDOMIZE TIMER
40 REM Define Tetromino Shapes
50 DATA 1,1,1,1,0,0,0,0,0,0,0,0  ' I-shape
60 DATA 1,1,1,0,0,1,0,0,0,0,0,0  ' T-shape
70 DATA 1,1,0,0,0,1,1,0,0,0,0,0  ' S-shape
80 DATA 0,1,1,0,1,1,0,0,0,0,0,0  ' Z-shape
90 DATA 1,1,0,0,1,0,0,0,1,0,0,0  ' L-shape
100 DATA 0,1,0,0,0,1,0,0,1,1,0,0 ' J-shape
110 DATA 1,1,0,0,1,1,0,0,0,0,0,0  ' O-shape
120 FOR P=0 TO 6: FOR I=0 TO 2: FOR J=0 TO 2: READ PIECES(P,I,J): NEXT:NEXT:NEXT
130 REM Game Initialization
140 X=4: Y=0: CP=INT(RND*7)
150 GAMEOVER=0
160 GOSUB 500 ' Draw Board
170 REM Game Loop
180 IF GAMEOVER=1 THEN PRINT "GAME OVER!": END
190 GOSUB 600 ' Draw Current Piece
200 IF Y<19 AND CHECK(X,Y+1,CP)=0 THEN Y=Y+1 ELSE GOSUB 700 ' Place Piece
210 GOSUB 500
220 REM Controls
230 K$=INKEY$
240 IF K$="Z" AND CHECK(X-1,Y,CP)=0 THEN X=X-1
250 IF K$="X" AND CHECK(X+1,Y,CP)=0 THEN X=X+1
260 IF K$=" " THEN CP=(CP+1) MOD 7
270 GOTO 180
280 REM Drawing the Board
500 CLS
510 FOR J=0 TO 19
520 FOR I=0 TO 9
530 IF BOARD(I,J)=1 THEN PRINT CHR$(219); ELSE PRINT ".";
540 NEXT: PRINT
550 NEXT
560 RETURN
570 REM Draw the Current Piece
600 FOR I=0 TO 2
610 FOR J=0 TO 2
620 IF PIECES(CP,I,J)=1 THEN LOCATE X+I,Y+J: PRINT CHR$(219);
630 NEXT:NEXT
640 RETURN
650 REM Check Collision
700 FOR I=0 TO 2
710 FOR J=0 TO 2
720 IF PIECES(CP,I,J)=1 THEN IF Y+J>=19 OR BOARD(X+I,Y+J+1)=1 THEN GOTO 750
730 NEXT:NEXT
740 RETURN 0
750 RETURN 1
760 REM Place Piece
770 FOR I=0 TO 2
780 FOR J=0 TO 2
790 IF PIECES(CP,I,J)=1 THEN BOARD(X+I,Y+J)=1
800 NEXT:NEXT
810 REM Check for Line Completion
820 FOR J=0 TO 19
830 COMPLETE=1
840 FOR I=0 TO 9
850 IF BOARD(I,J)=0 THEN COMPLETE=0
860 NEXT
870 IF COMPLETE=1 THEN FOR Y1=J TO 1 STEP -1: FOR I=0 TO 9: BOARD(I,Y1)=BOARD(I,Y1-1): NEXT:NEXT
880 NEXT
890 X=4: Y=0: CP=INT(RND*7)
900 IF CHECK(X,Y,CP)=1 THEN GAMEOVER=1
910 RETURN
